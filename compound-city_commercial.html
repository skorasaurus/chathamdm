<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8'">
<title>Citywide Commercial Buildings</title>

<style> 
.cdm ul {
  display: flex;
  flex-flow: row wrap; 
  align-items: center; 
  padding: 0 0 4em 0;
}


.cdm li {
  list-style: none;
  height: 300px; 
  padding: 2em;
  border: 0.25em solid black; 
  margin-top: -.25em;
  margin-left: -.25em;
  overflow: hidden;
}

.cdm img {
  justify-content: center;
  display: flex;
}

</style>

<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.4/fetch.min.js"></script>
</head>
<body>

<!-- Goal: display Display compound objects like the city planning slides: as a gallery; --> 

<h1>City Planning Commission Slide Collection</h1>
<p>These photographs are from the City Planning Commission Slide Collection at the Cleveland Public Library's digital photograph collection<p>. 

<p class="cdm"> </p>


<script>

// todo; 
// create a couple buttons that will load photos in groups of 50
// on initial page load, create all of the buttons; 
// 

// fetch(CONTENTDM_SOURCE)
//   .then(handleResponse)
//   then(function(myJson) {
//    for(var i = 0; i < myJson.page.length; i++) {
// for each 50, create a new button 

// then make a second fetch once the button is pressed, to determine 
// which 50 of the photos should be loaded. 

var CONTENTDM_SOURCE = 'https://sheltered-temple-69261.herokuapp.com/cdm16014.contentdm.oclc.org/digital/bl/dmwebservices/index.php?q=dmGetCompoundObjectInfo/p16014coll6/17538/json';

var LOCAL_SOURCE = './recentadditions.json';

var cdmSelector = document.querySelector('.cdm');


// url to view said item (baseURL), thumbnail of the item (thumbURL)

var htmlList = document.createElement('ul'); 
cdmSelector.appendChild(htmlList); 

var baseURL = 'https://cplorg.contentdm.oclc.org/digital/collection/p16014coll6/id/'; 

var thumbURL = ' http://cdm16014.contentdm.oclc.org/digital/iiif/p16014coll6/'; 

// function to get verbose errors since fetch isn't explicit
var handleResponse = function (theResponse) {
  return theResponse.json()
    .then(function (json) {
      if (theResponse.ok) {
        return json;
      } else {
        return Promise.reject(theResponse);
      }
    });
};



// example: https://cplorg.contentdm.oclc.org/digital/collection/p4014coll18/id/8658


/* create a list item for each result from the json, each contains:

title of the result, hyperlinked to the result in the collection
thumbnail of the result, hyperlinked to the result in the collection
new paragraph containing description of the result 
*/

// replace myJson.page.length with 51
fetch(CONTENTDM_SOURCE)
  .then(handleResponse)
  .then(function(myJson) {
    for(var i = 0; i < 51 ; i++) {
      console.log(myJson.page[i].title); 
        var listItem = document.createElement('li'); 
        htmlList.appendChild(listItem);
        var theLink = document.createElement('a');
        listItem.appendChild(theLink);
        theLink.href = baseURL + myJson.page[i].pageptr;
        theLink.textContent = myJson.page[i].title;
        var theImage = document.createElement('img');
        theLink.appendChild(theImage);
        theImage.src = thumbURL + myJson.page[i].pageptr + '/full/,300/0/default.jpg' ; 
        theImage.alt = myJson.page[i].descri;
        var theDescription = document.createElement('p');
        listItem.appendChild(theDescription);
        console.log(myJson.page[i].descri);
        theDescription.textContent = myJson.page[i].descri; 
        // theDescription.textContent = "HI MOM!";

        // append the creator text
    }
 });


console.log("this will log first");
</script>
</body>
</html>